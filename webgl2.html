<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body>
    <table class="fullheight" cellpadding="0" cellspacing="0" width="100%">
        <!--Header-->
        <tr>
            <td class="corner"></td>
            <td class="title"><h1>WebGL2 Realtime Video Dithering</h1></td>
        </tr>
        <!--Body-->
        <tr class="fullheight">
            <!--Nav Bar-->
            <td class="navCont">
                <div id="navBar">
                    <ul class="nav">
                        <li class="current"><a href="index.html">Home</a></li>
                        <li>
                            <p>Projects</p>
                            <ul>
                                <li><a href="all.html">All</a></li>
                                <li><a href="software.html">Software</a></li>
                                <li><a href="hardware.html">Hardware</a></li>
                            </ul>
                        </li>
                        <li><a href="resume.pdf">Resume</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                    <div id="soc">
                        <center>
                            <div>
                                <a class="icon" href="https://github.com/StrayerRussell"><img class="icon" src="./images/githubIcon.svg" title="GitHub"></a>
                                <a class="icon" href="https://linkedin.com/in/david-strayer-russell"><img class="icon" src="./images/linkedinIcon.svg" title="LinkedIn"></a>
                                <a class="icon" href="mailto:david.strayer.russell@gmail.com"><img class="icon" src="./images/emailIcon.svg" title="E-Mail"></a>
                            </div>
                        </center>
                    </div>
                    <div id="qr">
                        <p>Direct Page Link</p>
                        <center><div id="qrcode"></div></center>
                    </div>
                    <ul class="nav" id="color">
                        <p>Terminal Accent Color</p>
                        <li class="theme" id="amber" onclick="setTheme('#FFB000');">Amber</li>
                        <li class="theme" id="green" onclick="setTheme('#33FF33')">Green</li>
                        <li class="theme" id="white" onclick="setTheme('#FFFFFF')">White</li>
                        <li class="theme" id="purple" onclick="setTheme('#9500F2')">Purple</li>
                    </ul>
                </div>
            </td>
            <!--Main Body Section-->
            <td class="main fullheight" style="vertical-align: top;" width="100%">
                <div class="article">
                    <h2><a href="WebGL2PortfolioDemonstration.html">Live Demo</a></h2>
                    <img src="./images/webgl2ArticleArt.png" alt="Image showing the Webgl 2 real time dithering demo including a canvas, and various UI elements such as buttons">
                    <h3>Overview</h3>
                    <p>This is a demo application which uses WebGL2, combined with the getDisplayMedia() API, to capture the users screen and apply video processing effects in real time. The intention of these
                        effects is to convert the 24bit "High Color" image to a 1bit bitonal image while still maintiaining legibility (as much as possible at least).
                    </p>
                    <h3>Motivations</h3>
                    <p> I wanted to do this project for 2 reasons, firstly I think that dithering
                        looks really cool and the premise of ripping out 95.833% of the data from within an image while still maintaining any legibility at all is fascinating to me, and secondly by massivley reducing
                        the size of the image data (and as a side effect simplifying it to the point that it becomes trivial to obtain a high compression ratio with very simple algorithims) it should be possible to 
                        stream "Video" within an incredibly limited bitrate to very computationally constraned devces at a passable framerate and resolution, say for example an
                        <a href="cvbs.html">ESP32-S3 Tweaked to generate composite video</a>. 
                    </p>
                    <h3>Implementation</h3>
                    <p>
                        The usage of the WebGL2 shaders is fairly typical with the vertex shader being used to draw the screenshared video stream onto a texture and the fragment shader doing the lions share of the actual processing.
                        Due to the need to retain as much legibility as possible the processing is a fiar bit mroe complicated than simply applying an ordered dithering filter to the image. THe processing steps of the fragment Shader
                        are as follows.
                    </p>
                    <ol>
                        <li>
                            <p>Check saturation of current pixel</p>
                            <ul>
                                <li>If saturation is below threshold apply sharpening filter and basic thresholding</li>
                                <li>If saturation is above threshold proceed to step two</li>
                            </ul>
                        </li>
                        <li>Apply Sobel edge detection algorithim</li>
                        <li>Determine location in Bayer dithering grid</li>
                        <li>
                            <p>Determine if current pixel is an edge</p>
                            <ul>
                                <li>If edge value is above threshold do not apply dithering</li>
                                <li>If edge value is below threshold apply Bayer dithering</li>
                            </ul>
                        </li>
                        <li>
                            <p>Convert WebGL2 "Normalized Value (0.0 - 1.0) to RGBA8 (0 - 7FFFFFFF)"</p>
                            <ul>
                                <li>If normalized value is above 0.5 output 7FFFFFFF</li>
                                <li>If normalized value is below 0.5 output 0</li>
                            </ul>
                        </li>
                    </ol>
                    <p>The initial saturation check is to ensure text remains legible by increasing the sharpness of high contrast white/black borders and avoiding dithering.</p>
                    <p>The edge detection sharpens the edge of objects and allows sillohettes to be much more noticeable, allowing object differentiation and preventing similar objects from blending into one another.</p>
                    <p>Finally dithering is applied to high saturation non edge areas and the image is output.</p>
                    <h3>About the RGB8 color format</h3>
                    <p>It may seem odd that the output of the fragment shader is a RGBA8 texture. If the point of the shader is to compress the image data to one bit per pixel why are we outputing 32 bits per pixel but only using two of the possible values (0 or 77FFFFFFF). This is due to one of the limitations of WebGL2. The WebGL2 specification only requires support of the RGBA8 colorspace. All other colorspaces, such as R8A1 which would be much more fitting for this project are optional and unfortunatley not found in the implementaions employed in any of the common browsers that I have tested. WebGL2 also does not support reading back arbitrary components of a texture such as only reading the green or alpha component of a texture.</p>
		    <h3>Limitations</h3>
		    <p>Unfortunatley these limitations basically kill the viability of this project, as any latency experienced when shuffling
		    this data arround is multipled by a factor of 32. The most notable issue this causes is on systems with a discrete GPU as the
		    additional latency of reading data across the PCI-E bus scales massivley, to a minimum of 70ms per frame in my tests, usually
		    100ms or more (720 * 480 test image). </p>
		    <p>In summary this means that the absolute best preformance which can be expected from this project is sub par at best and is
		    massivley inconsistent depending on the device on which it is run (Ironically with better equipped systems preforming worse due
		    to bus latency). I am still glad I undertook this as it allowed me to experiment with the basics of graphics processing before
		    transitioning to the much more complicated (but much more capable) <a href="webgpu.html">WebGPU</a>.</p>
                </div>
            </td>
        </tr>
        <!--Footer-->
        <tr><td class="footer" colspan="2" height="48"><h5>Strayer Russell 2025</h5></td></tr>
    </table>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="script.js"></script>
    <script>document.onload = onLoad();</script>
  </body>
</html>
